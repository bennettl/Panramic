$(document).ready(function(){hd();feed();rightContainer();mod();guestListContainer();navCurrent("#feedList","#feedList .delete");navCurrent("#reviewWall","#reviewWall .delete");navCurrent("#tabTop","#tabTop a");navCurrent("#inbox","#inbox .delete");navCurrent("#pageList","#pageList a");deleteTip();$("input:not([name='s'])").live("keydown",function(a){if(a.which==13){a.preventDefault()}})});function deleteTip(){$(".delete").live("click",function(){if($("#deleteTip").css("display")=="none"){var b=$(this).parent("li");var c=$(this).position().left;var a=$(this).position().top;$("#deleteTip").css({top:a+12+"px",left:c-61+"px"}).appendTo(b).show()}else{if($("#deleteTip").css("display")=="block"){$(this).removeClass("current");$("#deleteTip").appendTo("#leftContainer").hide()}}if($(this).parents(".msgReply").length==1){$("#reportBtn").hide()}else{$("#reportBtn").show()}if($("#sidenavTop #tab_everyFeed.current").length==1||$("#sidenavTop #tab_friendFeed.current").length==1){$("#removeBtn").hide()}else{$("#removeBtn").show()}$("#friendTip").hide()})}function navCurrent(b,a){$(a).live("click",function(){if($(a+".current .sideNoti").length==1){$(a+".current .sideNoti").remove()}$(b+" .current").removeClass("current");$(this).addClass("current");return false})}function fadeInSubmit(b,a){$(a).hide();$(b).live("focus",function(){$(this).siblings(a).fadeIn(300)});$(a).live("click",function(){$(this).fadeOut(300)})}function textExpand(a){$(a).each(function(){var c=$(this).height();var b=($(this).val().match(/\n/g)==null)?0:$(this).val().match(/\n/g).length;$(this).keyup(function(){var f=($(this).val().match(/\n/g)==null)?0:$(this).val().match(/\n/g).length;var g=f-b;var e=(f-b==0)?0:g*20;var d=c+e;$(this).height(d)})})}function feedToggle(){var a=($.browser.mozilla)?"36px":"39px";$(".feedDescription").each(function(){var d=$(this).parents("li.feed");var c=parseInt($(this).css("height","auto").height());var b=$(this).parents(".feedInfo").find(".moreInfo");$(this).height(a);if(b.length==0){if(c>parseInt(a)){$(this).parents(".feedInfo").append("<tr><td colspan='2'><a href='#' class='moreInfo'>more...</a></td></tr>")}else{if(d.css("display")=="list-item"){$(this).css("padding","0 0 15px 0")}}}});$(".feedInfo .moreInfo").click(function(){if($(this).text()=="more..."){$(this).parents(".feedInfo").find(".feedDescription").css("height","auto");$(this).text("hide")}else{if($(this).text()=="hide"){$(this).parents(".feedInfo").find(".feedDescription").css("height",a);$(this).text("more...")}}$("#friendTip").hide();return false})}function deleteHover(a){$(a).live("mouseenter",function(){var b=$(this).children(".delete");if(b.length==1){b.show()}});$(a).live("mouseleave",function(){var c=$(this).children(".delete");var b=$(this).children(".delete.current");if(c.length==1&&b.length==0){c.hide()}})}function validateEmail(b){var c=/^([A-Za-z0-9_\-\.]){3,}\@([A-Za-z0-9_\-\.]){3,}\.([A-Za-z]{2,4})$/;var a=b.val();if(c.test(a)==false){errorMsg="Invalid email address";return errorMsg}}function validateField(d){var b=/^([A-Za-z0-9_\-\.\,\/\'\s]){1,}$/;for(var a=0;a<d.length;a++){var c=$("input[name='"+d[a]+"']").val().replace(/\s/g,"");if(b.test(c)==false){switch(d[a]){case"firstname":errorMsg="Invalid first name";break;case"lastname":errorMsg="Invalid last name";break;default:errorMsg="Invalid "+d[a];break}return errorMsg}}}function validateFile(a){if(a!=""&&a.indexOf(".jpg")==-1&&a.indexOf(".gif")==-1&&a.indexOf(".png")==-1){errorMsg="Image must be jpg, png, or gif format"}return errorMsg}function fileInput(){var a=($.browser.mozilla)?"90px":"25px";$(".fileContainer .inputFile").css("right",a);$(".fileText").live("focus",function(){$(this).blur()});$(".inputFile").live("click",function(){var d=$(this);c(d)});$(".cancelBtn").live("click",function(){var d=$(this).parents(".fileContainer").find(".inputFile");var e=$(this).parents(".fileContainer").find(".fileText");if(d.val()!=""){d.val("");e.val("")}return false});function c(e){var d=e.parents(".fileContainer").find(".inputFile");if($.browser.msie){setTimeout(function(){b(d)},0)}else{d.change(function(){b(d)})}}function b(d){var e=d.val();var f=e.indexOf("C:\\fakepath\\");if(f>-1){e=e.substr(12)}d.parent(".fileContainer").find(".fileText").val(e)}}function addBtn(){$("#addBtn").click(function(){if($(this).text()=="Join"){var b=$("#groupInfo input[name='groupId']").val();var a=$("<span style='font-weight:bold;'>Member Request Sent</span>");$.post("ajax/ajax.add.php",{memberRequest:"true",groupId:b})}if($("#profileName").text().length<30){$(this).removeAttr("id").css({padding:"30px 0 0 0","float":"left"}).html(a)}else{$(this).removeAttr("id").css({padding:"0 0 0 6px","float":"left"}).html(a)}})}function pageList(){if($("#feedContainer").length==1){$("#feedContainer #pageList a").click(function(){var a=$(this).attr("href").substr(1);var b=($("#foodOn.current").length==1)?"freeFood=true&":"";b+="myCal=true&pageNum="+a;$("#friendTip").appendTo("#leftContainer").hide();$("#deleteTip").appendTo("#leftContainer").hide();$("#loading").show();$.post("home.userFeed.php",b,function(c){var d=$(c).find("#feedList");$("#loading").hide();$("#feedList").replaceWith(d);$("#feedList").hide().fadeIn(500);feedToggle();filterPersist();feedNoti()},"html")})}else{if($("#reviewWall").length==1){$("#reviewWall #pageList a").click(function(){var a=$(this).attr("href").split("_");var c=a[0].substr(1);var b=a[1];$("#loading").show();$("#deleteTip").appendTo("#leftContainer");$.post("gprofile.reviewWall.php",{pageNum:c,groupId:b},function(e){var d=e;$(".msgFeedContainer").replaceWith(d);$("#loading").hide();$(".msgFeedContainer").hide().fadeIn(500);reviewWall()},"html")})}}}function toggleText(b,a){$(b).focus(function(){if($(this).val()==a){$(this).val("").removeClass("inactiveText")}});$(b).blur(function(){if($(this).val()==""){$(this).val(a).addClass("inactiveText")}})}function hd(){if($("#hd .searchText").val()!=""){$("#hd .searchContainer").addClass("active");$("#hd .searchSubmit").addClass("mglasslight")}$("#hd .searchText").focus(function(){$("#hd .searchContainer").addClass("active");$("#hd .searchSubmit").addClass("mglasslight")});$("#hd .searchText").blur(function(){var a=$(this).val().replace(/\s/g,"");if(a==""){$("#hd .searchContainer").removeClass("active");$("#hd .searchSubmit").removeClass("mglasslight")}});$("#menu #account").toggle(function(){$(this).addClass("accountActive");$("#dropdown").show();if($.browser.webkit){$("#dropdown").css("right","42px")}},function(){$(this).removeClass("accountActive");$("#dropdown").hide()});$("#signIn").toggle(function(){$(this).addClass("signInA");$("#signInForm").show();return false},function(){$(this).removeClass("signInA");$("#signInForm").hide();return false});$(".signInText").focus(function(){var a=$(this).val();if(a.indexOf("USC Email")>-1){$(this).val("");$(this).removeClass("inactiveText")}});$(".signInText").blur(function(){var a=$(this).val();if(a==""){$(this).val("Enter USC Email");$(this).addClass("inactiveText")}});$("#signInBtn").click(function(){var e="email="+$(".signInText").val()+"&signIn=true";var a="258940897480780";var d="";var c=/^([A-Za-z0-9_\-\.]){3,}\@(usc\.edu)$/;var b=$("[name='email']").val();if(c.test(b)==false){d="Invalid USC Email"}$("#signInError").hide();if(d==""){FB.init({appId:a,status:true,cookie:true,xfbml:true,oauth:true});FB.login(function(f){if(f.authResponse){FB.getLoginStatus(function(g){if(g.status==="connected"){var i=g.authResponse.userID;var h=g.authResponse.accessToken;FB.api("me/permissions?access_token="+h,function(l){var n=l.data[0].publish_stream;var k=l.data[0].read_stream;var m=l.data[0].rsvp_event;var o=l.data[0].read_friendlists;var j=l.data[0].offline_access;if(n&&k&&o&&j){e+="&fbid="+i;signIn(e)}else{$("#signInError").html("To give you the best user experience, Panramic <br /> requires certain Facebook permssions");$("#signInError").show()}})}})}},{scope:",publish_stream,read_stream,rsvp_event,read_friendlists,offline_access"})}else{$("#signInError").html("Invalid USC Email");$("#signInError").show()}})}function signIn(a){$.post("ajax/ajax.signin.php",a,function(b){if(b.success=="yes"){window.location=b.message}else{if(b.success=="no"){$("#signInError").text(b.message).show()}}},"json")}function hdClear(){$("#hdClear").mouseenter(function(){$(this).addClass("waiting");setTimeout(function(){if($("#hdClear").hasClass("waiting")){$("#hd").slideDown(400);$("#hdClear").removeClass("waiting")}},1000)});$("#hdClear").mouseleave(function(){$(this).removeClass("waiting")});$("#hd").mouseleave(function(){if($("#hdClear").length==1&&$(".searchContainer.active").length==0&&$("#account.accountActive").length==0){$("#hd").slideUp(500)}})}function feed(){$(".feed").live("click",function(){$("#friendTip").hide()});$(".feed").live("mouseleave",function(){if($(".feedSideTip").length>0){$(".feedSideTip").removeClass("feedSideTip")}else{if($("#friendTip").length==1){$("#friendTip").hide()}}});$(".feedDate a").live("click",function(){$(this).addClass("hidden");$(this).siblings("a.hidden").removeClass("hidden");return false});$(".sideOptions").live("mouseover",function(){var b=$(this).attr("title");var e=$(this).position().left;var d=$(this).position().top;var c=$(this).parents(".feedSide");$("#sideOptionTip").css({top:d-29+"px",left:e-9+"px"}).appendTo(c).text(b).show();$(this).removeAttr("title")});$(".sideOptions").live("mouseout",function(){var b=$("#sideOptionTip").text();$("#sideOptionTip").hide().appendTo("#leftContainer");$(this).attr("title",b)});$(".like.sideOptions").live("click",function(){if(document.cookie.indexOf("e=")==-1){var f=$(window).scrollTop()+100;$("#loginMod").css({top:f+"px"}).show();return false}var d=$(this).parents(".feed").attr("value");var e=($(this).parents(".feed").attr("class").indexOf("fbEvent")>-1)?true:false;var c=($("#fbPermission [name='rsvp']").val()=="true")?true:false;var g={attendEvent:"true",eventId:d,fbEvent:e,rsvp:c};var b;if(e&&c){b="Event rsvped on Facebook and moved to your calendar"}else{if(e&&!c){b="Event moved to your calendar. To add Facebook rsvp feature, please go to your Panramic account settings"}else{b="Event moved to your calendar"}}$(this).parents(".feed").addClass("feedSelected");$("#sideOptionTip").appendTo("#leftContainer").hide();if($(".mediumList").length>0){if($("#eventInv").length==1){$("#friendText").text("")}$(".mediumList li.feed[value='"+d+"']").find(".like").css("visibility","hidden");$(".mediumList li.feed[value='"+d+"']").find(".dislike").css("visibility","hidden")}$(".feedSelected").replaceWith("<li class='notification'>"+b+"</li>");$.post("ajax/ajax.feed.php",g)});$(".dislike.sideOptions").live("click",function(){if(document.cookie.indexOf("e=")==-1){var c=$(window).scrollTop()+100;$("#loginMod").css({top:c+"px"}).show();return false}$(this).addClass("selected");var c=$(window).scrollTop()+100;var b="By disliking a group, you will no longer recieve <strong>ANY</strong> events from this group. It's usually safer to remove an event rather than disliking a group and <strong> miss out on all of their events!</strong>";$("#notiText").html(b);$("#notiMod").addClass("dislike").css({top:c+"px"}).show()});$(".invite.sideOptions").live("click",function(){var d=$(this).parents("li").find(".feedName").text();var c=$(this).parents("li").find(".feedLocation").text();var b="258940897480780";FB.init({appId:b,status:true,cookie:true,xfbml:true,oauth:true});FB.ui({method:"apprequests",message:'Check out "'+d+'" at '+c+" on Panramic."})});$("#confirmNoti").live("click",function(){if($(this).parent("#notiMod.dislike").length==1){var h=$(".dislike.sideOptions.selected").parents(".feed").find(".groupName").attr("value");var j=$("<li class='notification'>Group Blocked</li>");$(this).parent("#notiMod").removeClass("dislike");$(".dislike.sideOptions.selected").parents(".feed").replaceWith(j);$.post("ajax/ajax.feed.php",{dislikeGroup:"true",groupId:h})}else{if($(this).parent("#notiMod.removeEvt").length==1){var b=$(".miniEvt.selected").attr("value");var c=($("[name='fbstatus']:eq(0)").val()=="true")?true:false;var k=$(".miniEvt[value='"+b+"']").next().find("[name='fbid']").val();var d=$("[name='pushFb']").is(":checked");var g=($("[name='gstatus']:eq(0)").val()=="true")?true:false;var i=$(".miniEvt[value='"+b+"']").next().find("[name='gid']").val();var f=$(".miniEvt[value='"+b+"']").next().find("[name='gcalid']").val();var l=$("[name='pushGoogle']").is(":checked");var e={removeEvt:true,eventId:b,fbid:k,fbstatus:c,gid:i,gcalid:f,gstatus:g,};var j=$("<li><div class='listNote'>Event Removed</div></li>");e.pushFb=(d)?true:false;e.pushGoogle=(l)?true:false;$(this).parent("#notiMod").removeClass("removeEvt");$("#formContainer li").hide();$("#eventNoti").hide();$("#deleteList").appendTo("#leftContainer").hide();$(".miniEvt.selected").replaceWith(j);$.post("ajax.groupManage.php",e)}}$(this).parent().hide()});$("#notiMod .delete").live("click",function(){if($(this).parent("#notiMod.dislike").length==1){$(this).parent("#notiMod").removeClass("dislike");$(".dislike.sideOptions.selected").removeClass("selected")}else{if($(this).parent("#notiMod.removeEvt").length==1){$(this).parent("#notiMod").removeClass("removeEvt");$(".miniEvt.selected").removeClass("selected")}}});$("#evtInvForm").live("submit",function(){var b=$(this).serialize()+"&evtInvForm=true";$.post("ajax/ajax.feed.php",b);$("#evtInvForm input:checked").removeAttr("checked");$("#evtInvForm input[name='event']").val("");$("#inviteMod").hide();return false});$("#feedList #removeBtn").live("click",function(){var c=$(this).parents(".feed").attr("value");var b=$("<li class='notification'>Event removed</li>");$(this).parents(".feed").hide().after(b);$.post("ajax/ajax.feed.php",{removeEvent:"true",eventId:c});return false});$("#feedList #reportBtn").live("click",function(){if($(".feedReport").length==0){var b=$(this).parents(".feed").attr("value");var c=$(window).scrollTop()+50;$("#reportMod").css("top",c+"px").show();$(this).parents(".feed").addClass("feedReport");$("#reportForm").find("[name='eventId']").val(b);$("#deleteTip").appendTo("#leftContainer").hide();$(".delete.current").removeClass("current")}return false});a(".feedUserAttend",".feedUserInfo");a(".feedFriendAttend",".feedFriendInfo");function a(c,b){$(c).live("mouseenter",function(){var h=$(this).position().left;var g=$(this).position().top;var e=$(this).parents(".feedSide");var d=$(this).siblings(b).find("li");if(d.length>0){var f=d.clone(true,true);$("#friendTip").appendTo(e).css({top:g+13+"px",left:h-68+"px"}).html(f).show()}else{$("#friendTip").hide()}})}$("#friendTip").live("mouseleave",function(){$(this).hide();if($(".feedSideTip").length==1){$(this).show()}$("#sideTip").hide()});$("#friendTip img").live("mouseenter",function(){var b=$(this).attr("alt");var d=$(this).offset().left;var c=$(this).offset().top;$("#sideTip").appendTo("body").css({top:c+1+"px",left:d+34+"px"}).text(b).show()});$("#friendTip img").live("mouseleave",function(){$("#sideTip").addClass("feedSideTip").appendTo("#container").hide()})}function guestListContainer(){navCurrent(".guestTab",".guestTab li a");$(".guestText").live("focus",function(){if($(this).val("Find...")){$(this).val("").removeClass("inactiveText")}});$(".guestText").live("blur",function(){if($(this).val()==""){$(this).val("Find...").addClass("inactiveText")}});$(".guestTab a").live("click",function(){var a=$(this).attr("id").substring(4);$(".guestListContainer > div").hide();$(".guestListContainer div."+a).fadeIn(500);$(".guestListContainer div."+a+" *").show();return false});$(".guestListContainer .list").live("mouseover",function(){$(this).css("background","#EEF3F4");$(this).find(".checkbox").css("color","#333333")});$(".guestListContainer .list").live("mouseout",function(){$(this).removeAttr("style");$(this).find(".checkbox").removeAttr("style")});$(".guestListContainer .list a").live("click",function(){$(this).siblings("input[type='checkbox']").click();return false});$(".guestText").live("keyup",function(){$(".guestListContainer > div:visible *").show();var a=$(this).val().replace(/\s/g,"");if(a!=""){a=$(this).val().toLowerCase();$(".guestListContainer > div:visible").find(".checkbox").each(function(){if($(this).text().toLowerCase().indexOf(a)==-1){$(this).parents("li.list").hide()}});$(".guestListContainer > div:visible .listContainer").each(function(){if($(this).children(":visible").length==0){$(this).prev("div").hide();$(this).hide()}})}})}function evtWall(){if($("#evtWall .mediumList > li").length>0){var a=$(".mediumList li:first").next(".feed").clone(true,true);$(".evtContainer:first").html(a).children().show();feedToggle()}$("#evtWall .mediumList > li:not('.feed')").click(function(){var b=$(this).next("li.feed").clone(true,true);$(this).parent(".mediumList").siblings(".evtContainer").html(b);$("#evtWall .evtContainer li").fadeIn(500);feedToggle()})}function userWall(){toggleText("#fuserText","Find...");$("#fuserText").keyup(function(){$("#userWall li:has('.listName'), #moreUserBtn").show();var a=$(this).val().replace(/\s/g,"");if(a!=""){a=$(this).val().toLowerCase();$("#userWall .listName").each(function(){var b=$(this).text().toLowerCase();if(b.indexOf(a)==-1){$(this).parent("li").hide();$("#moreUserBtn").hide()}})}});$("#userWall .mediumList li:gt(49)").hide();if($("#userWall .mediumList li").length>49){$("<li><a id='moreUserBtn' href='#'>Show All...</a></li>").appendTo("#userWall .mediumList")}$("#moreUserBtn").live("click",function(){$(this).hide();$("#userWall .mediumList li").show();return false})}function rightContainer(){$("#rightContainer i, #rightContainer img, #signupGroup img").hover(function(){var c=$(this).offset().left;var b=$(this).offset().top;var a=($(this).attr("class"))?$(this).attr("class"):$(this).attr("alt");if($(this).parents("ul.smallList").length==1){$("#sideTip").appendTo("body").css({top:b+1+"px",left:c+36+"px"}).text(a).show()}else{$("#sideTip").appendTo("body").css({top:b+1+"px",left:c+34+"px"}).text(a).show()}},function(){$("#sideTip").appendTo("#container").hide()})}function mod(){b();a();function b(){$("#reportMod [name='comment']").focus(function(){var c=$(this).val();if(c.indexOf("Please tell us what the problem is")>-1){$(this).removeClass("inactiveText");$(this).val("")}});$("#reportMod [name='comment']").blur(function(){var c=$(this).val();if(c==""){$(this).val("Please tell us what the problem is").addClass("inactiveText")}});$("#reportForm").submit(function(){var e=$(this).serialize();var d=$(this).find("[name='comment']").val();errorMsg="";if((d=="")||(d.indexOf("Please tell us what the problem is")>-1)){errorMsg="Please fill in a message"}if(errorMsg==""){if($(".feedReport").length==1){var c=$("<li class='notification'>Event reported</li>");e=e+"&reportEvent=true";$(".feedReport").replaceWith(c);$("#reportForm").find("[name='eventId']").removeAttr("value");$.post("ajax/ajax.feed.php",e)}else{if($(".msgReport").length==1){var c=$("<div class='notification'>Message reported</div>");e=e+"&reportMsg=true";$(".msgReport").replaceWith(c);$("#reportForm").find("[name='msgId']").removeAttr("value");$.post("ajax/ajax.inbox.php",e)}}$("#reportMod").find(".noti").text("Report sent. Thank you for the heads up!").show();$("#reportForm").hide()}else{$("#reportMod").find(".noti").text(errorMsg).show()}return false});$("#reportMod .delete").click(function(){$("#reportMod").find(".noti").hide();$("#reportForm [name='comment']").val("Please tell us what the problem is").addClass("inactiveText");$("#reportForm").show();$(".feedReport").removeClass("feedReport");$(".msgReport").removeClass("msgReport");$("#reportForm").find("[name='eventId']").removeAttr("value");$("#reportForm").find("[name='msgId']").removeAttr("value")})}function a(){$("#feedbackBtn").click(function(){if($("#feedbackMod").css("display")=="none"){var c=$(window).scrollTop()+50;$("#feedbackMod").css("top",c+"px").show()}else{if($("#feedbackMod").css("display")=="block"){$("#feedbackMod").hide()}}});$(".feedbackText").focus(function(){if($(this).hasClass("inactiveText")){$(this).val("").removeClass("inactiveText")}});$(".mod .delete").live("click",function(){$("#feedBackForm").show();$("#feedbackNoti").hide();$(this).parent().hide()});$("#feedBackForm").submit(function(){var d=$(this).serialize()+"&feedBackForm=true";var c=$(this).find(".feedbackText").val();var e="Please tell us if you have any ideas, suggestions, or feedback. We love to hear from you!";if(c!=""&&c!=e){$(".feedbackText").val(e).addClass("inactiveText");$(this).hide();$.post("ajax/ajax.mail.php",d);$("#feedbackNoti").show()}return false})}}function checkfbPermission(){var a="258940897480780";FB.init({appId:a,status:true,cookie:true,xfbml:true,oauth:true});FB.getLoginStatus(function(b){if(b.status==="connected"){var c=b.authResponse.accessToken;FB.api("me/permissions?access_token="+c,function(f){var h=(f.data[0].publish_stream)?"true":"false";var e=(f.data[0].read_stream)?"true":"false";var g=(f.data[0].rsvp_event)?"true":"false";var i=(f.data[0].read_friendlists)?"true":"false";var d=(f.data[0].offline_access)?"true":"false";$("[name='publishs']").val(h);$("[name='readStream']").val(e);$("[name='rsvp']").val(g);$("[name='readFriend']").val(d);$("[name='offline']").val(d)})}else{if(b.status==="not_authorized"){}else{}}})};